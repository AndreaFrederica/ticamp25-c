import{c as createComponent,h,e as inject,A as quasarKey,s as defineComponent,r as ref,o as onMounted,B as onActivated,m as reactive,q as onUnmounted,w as watch,t as createBlock,u as withCtx,x as openBlock,C as createBaseVNode,y as createVNode,D as createElementBlock,E as toDisplayString,F as withDirectives,G as vShow,z as createTextVNode,H as Fragment,I as renderList,J as createCommentVNode}from"./index-Doj1G8aN.js";import{u as useSpinnerProps,c as useSpinner,Q as QBtn}from"./QBtn-Bkoujcpn.js";import{Q as QPage,a as QCard,b as QSeparator,c as QSelect,d as QDialog,e as QCardSection,f as QInput,_ as _export_sfc}from"./_plugin-vue_export-helper-CnEeIgSC.js";import"./scroll-_gICSfJW.js";const QSpace=createComponent({name:"QSpace",setup(){const s=h("div",{class:"q-space"});return()=>s}}),innerHTML='<g transform="translate(-20,-20)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="90 50 50" to="0 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g><g transform="translate(20,20) rotate(15 50 50)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="90 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g>',QSpinnerGears=createComponent({name:"QSpinnerGears",props:useSpinnerProps,setup(s){const{cSize:e,classes:t}=useSpinner(s);return()=>h("svg",{class:t.value,width:e.value,height:e.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg",innerHTML})}});function useQuasar(){return inject(quasarKey)}const _hoisted_1={class:"row items-center q-mb-md"},_hoisted_2={class:"row"},_hoisted_3={class:"col-6"},_hoisted_4={class:"flex"},_hoisted_5={class:"text-subtitle2"},_hoisted_6={class:"text-subtitle2"},_hoisted_7={class:"text-subtitle2"},_hoisted_8={class:"text-subtitle2"},_hoisted_9={class:"row q-gutter-sm q-mt-sm"},_hoisted_10={class:"q-mt-sm"},_hoisted_11={class:"row q-gutter-sm q-mt-sm"},_hoisted_12={class:"q-mt-sm"},_hoisted_13={class:"col-6"},_hoisted_14={key:0,class:"q-mt-md"},_hoisted_15={class:"row items-center q-mb-sm"},_hoisted_16={class:"text-subtitle2"},_hoisted_17={class:"text-weight-bold"},_hoisted_18={class:"q-mt-sm"},_hoisted_19={key:0},_hoisted_20={key:1},_hoisted_21={key:0},_hoisted_22={class:"q-mt-sm"},_hoisted_23={key:0},_hoisted_24={key:1},_hoisted_25={key:0},_hoisted_26={key:1},_hoisted_27={class:"text-caption"},_hoisted_28={key:0,class:"q-mt-sm"},_hoisted_29={key:1,class:"q-mt-sm"},_hoisted_30={key:0},_hoisted_31={key:1,class:"text-caption text-grey"},_hoisted_32={key:0,class:"q-mt-md q-pa-sm",style:{"border-radius":"4px"}},_hoisted_33={class:"text-caption"},_hoisted_34={key:1,class:"q-mt-md q-pa-sm",style:{"border-radius":"4px"}},_hoisted_35={class:"keyboard-layout"},_hoisted_36={class:"keyboard-row"},_hoisted_37={class:"keyboard-row"},_hoisted_38={class:"keyboard-row"},_hoisted_39={class:"keyboard-row"},_hoisted_40={class:"keyboard-row"},DEFAULT_FORMULA="((524.38/x)**(1/1.003))",DEFAULT_FACTOR=1.0261,_sfc_main=defineComponent({__name:"IndexPage",setup(__props){const formula=ref(""),correctionFactor=ref(1);async function loadConfigs(){try{const s=await fetch("/config/custom_string"),{success:e,custom_config:t}=await s.json();e?(formula.value=t.distance_formula||DEFAULT_FORMULA,correctionFactor.value=parseFloat(t.correction_factor)||DEFAULT_FACTOR):(formula.value=DEFAULT_FORMULA,correctionFactor.value=DEFAULT_FACTOR)}catch(s){console.error("加载配置失败",s),formula.value=DEFAULT_FORMULA,correctionFactor.value=DEFAULT_FACTOR}}onMounted(loadConfigs),onActivated(loadConfigs);const stats=reactive({count:0,total_pixels:0,frame_ratio:0,black_ratio:0,fps:0}),displayedRects=ref([]),removalTimers=new Map,cachedMeasurements=ref(void 0),cached=ref(!1),fucked=ref(!1),measurements=ref([]),measurementsLoading=ref(!1),a4Reference=ref(null),minSquareLoading=ref(!1),ocrTargetText=ref(""),ocrLoading=ref(!1),ocrElapsedTime=ref(0),ocrMethod=ref(5),showDetailedInfo=ref(!1),showVirtualKeyboard=ref(!1),isFullscreen=ref(!1);function onKeyPress(s){s==="Backspace"?ocrTargetText.value=ocrTargetText.value.slice(0,-1):s==="Space"?ocrTargetText.value+=" ":s==="Enter"?(showVirtualKeyboard.value=!1,getOrWaitOcrMeasurements()):s==="Clear"?ocrTargetText.value="":ocrTargetText.value+=s}function closeKeyboard(){showVirtualKeyboard.value=!1}function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen().then(()=>{isFullscreen.value=!1}).catch(s=>{console.error("退出全屏时出错:",s)}):document.documentElement.requestFullscreen().then(()=>{isFullscreen.value=!0}).catch(s=>{console.error("进入全屏时出错:",s)})}function handleFullscreenChange(){isFullscreen.value=!!document.fullscreenElement}function computeDistance(px){try{const formulaWithValue=formula.value.replace(/x/g,px.toString()),result=eval(formulaWithValue);return result*100}catch(s){return console.error("计算距离时出错:",s,"公式:",formula.value,"像素:",px),0}}async function getPower(){try{const s=await fetch("/api/ina226/measurements"),e=await s.json();s.status===200?(power.value=e.data.power_w||0,current.value=e.data.current_a||0,voltage.value=e.data.bus_voltage_v||0,e.data.power_w>maxPower.value&&(maxPower.value=e.data.power_w)):console.error("获取功率数据失败:",e)}catch(s){console.error("获取功率数据时出错:",s)}}async function getMeasurements(s=10,e=100){measurementsLoading.value=!0;let t=0;for(;t<s;)try{t++,console.log(`尝试获取物理测量数据 - 第 ${t} 次`);const a=await(await fetch("/api/physical_measurements")).json();if(a.success&&a.measurements&&a.measurements.length>0){measurements.value=a.measurements,a4Reference.value=a.a4_reference||null,console.log(`✓ 成功获取物理测量数据，共 ${a.measurements.length} 个测量结果`);break}else{if(console.warn(`第 ${t} 次尝试：未获取到有效测量数据`),t>=s){console.error("达到最大重试次数，未能获取到有效数据"),measurements.value=[],a4Reference.value=null;break}await new Promise(l=>setTimeout(l,e))}}catch(o){if(console.error(`第 ${t} 次尝试获取测量数据时出错:`,o),t>=s){measurements.value=[],a4Reference.value=null;break}await new Promise(a=>setTimeout(a,e))}measurementsLoading.value=!1}async function getMinimumSquareMeasurements(s=10,e=100){minSquareLoading.value=!0;let t=0;for(;t<s;){try{const a=await(await fetch("/api/minimum_square")).json();if(a.found){const l=[{crop_index:1,target:{id:1,crop_width:Math.abs(a.end_point[0]-a.start_point[0]),crop_height:Math.abs(a.end_point[1]-a.start_point[1]),area:Math.abs(a.end_point[0]-a.start_point[0])*Math.abs(a.end_point[1]-a.start_point[1]),new_long_px:a.edge_length_px},shapes:[{shape_index:1,shape_type:`Minimum Edge (${a.type})`,pixel_dimensions:{width:a.edge_length_px,height:0,area:0,side_lengths:[a.edge_length_px],mean_side_length:a.edge_length_px,perimeter:0},physical_dimensions:{width_mm:a.edge_length_mm,height_mm:0,area_mm2:0,diameter_mm:0,side_lengths_mm:[a.edge_length_mm],mean_side_length_mm:a.edge_length_mm,perimeter_mm:0,measurement_type:"minimum_edge",mm_per_pixel:a.edge_length_mm/a.edge_length_px}}]}];measurements.value=l,a4Reference.value={physical_width_mm:a.edge_length_mm,physical_height_mm:a.edge_length_mm,note:`在中心 (${a.center[0]}, ${a.center[1]}) 检测到最小边缘，长度: ${a.edge_length_mm.toFixed(2)}mm`},minSquareLoading.value=!1;return}else t<s-1&&(console.log(`最小边长测量第 ${t+1} 次尝试未找到数据，${e}ms 后重试...`),await new Promise(l=>setTimeout(l,e)))}catch(o){console.error(`最小边长测量第 ${t+1} 次尝试失败:`,o),t<s-1&&await new Promise(a=>setTimeout(a,e))}t++}console.error(`最小边长测量在 ${s} 次尝试后仍未获取到数据`),measurements.value=[],a4Reference.value=null,minSquareLoading.value=!1}async function getOrWaitOcrMeasurements(){for(fucked.value=!0;!cached.value||!cachedMeasurements.value;)await new Promise(s=>setTimeout(s,200));console.log(cachedMeasurements.value),measurements.value=cachedMeasurements.value.map(s=>({...s,shapes:s.shapes.filter(e=>ocrTargetText.value.trim()?e.ocr_data.detected&&e.ocr_data.text.toLowerCase().includes(ocrTargetText.value.toLowerCase()):e.ocr_data.detected)})).filter(s=>s.shapes.length>0),cached.value=!1,cachedMeasurements.value=void 0,fucked.value=!1}async function getOcrMeasurements(){ocrLoading.value=!0;try{const s=["/api/ocr_measurement_analysis","/api/ocr_masked_analysis","/api/ocr_masked_measurement_analysis","/api/ocr_scaled_measurement_analysis","/api/ocr_auto_segment_analysis","/api/ocr_auto_segment_easyocr_analysis"],e=s[typeof ocrMethod.value=="number"&&ocrMethod.value>=0&&ocrMethod.value<s.length?ocrMethod.value:0],o=await(await fetch(e)).json();if(o.success){ocrElapsedTime.value=o.elapsed_seconds||0;const a=o.analysis.map(l=>({crop_index:l.crop_index,target:l.target,shapes:l.shapes.map(i=>({shape_index:i.shape_index,shape_type:`${i.shape_type} (OCR: "${i.ocr_data.text}")`,pixel_dimensions:{width:i.pixel_dimensions.width,height:i.pixel_dimensions.height,area:i.pixel_dimensions.area,side_lengths:i.pixel_dimensions.side_lengths||[],mean_side_length:i.pixel_dimensions.mean_side_length||0,perimeter:i.pixel_dimensions.perimeter},physical_dimensions:{width_mm:i.physical_dimensions.width_mm,height_mm:i.physical_dimensions.height_mm,area_mm2:i.physical_dimensions.area_mm2,diameter_mm:i.physical_dimensions.diameter_mm||0,side_lengths_mm:i.physical_dimensions.side_lengths_mm||[],mean_side_length_mm:i.physical_dimensions.mean_side_length_mm||0,perimeter_mm:i.physical_dimensions.perimeter_mm,measurement_type:i.physical_dimensions.measurement_type,mm_per_pixel:i.physical_dimensions.mm_per_pixel},ocr_data:i.ocr_data}))})).filter(l=>l.shapes.length>0);cachedMeasurements.value=a,cached.value=!0}else console.error("获取 OCR 测量数据失败:",o),cachedMeasurements.value=void 0}catch(s){console.error("获取 OCR 测量数据时出错:",s),cachedMeasurements.value=void 0}finally{ocrLoading.value=!1}}onMounted(async()=>{document.addEventListener("fullscreenchange",handleFullscreenChange);try{const o=await fetch("/config/custom_string?key=distance_formula");if(o.ok){const a=await o.json();a.success&&a.value?(formula.value=a.value,console.log("已加载距离公式:",formula.value)):console.log("未找到保存的距离公式，使用默认值")}}catch(o){console.error("加载公式配置时出错:",o)}try{const o=await fetch("/config/custom_string?key=correction_factor");if(o.ok){const a=await o.json();if(a.success&&a.value){const l=parseFloat(a.value);!isNaN(l)&&l>0&&(correctionFactor.value=l,console.log("已加载修正系数:",l))}else console.log("未找到保存的修正系数，使用默认值:",correctionFactor.value)}}catch(o){console.error("加载修正系数配置时出错:",o)}const e=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/ws`,t=new WebSocket(e);t.onmessage=o=>{const a=JSON.parse(o.data);stats.count=a.count,stats.total_pixels=a.total_pixels,stats.frame_ratio=a.frame_ratio,stats.black_ratio=a.black_ratio,stats.fps=a.fps;const l=a.rects,i=new Set(l.map(n=>n.id));l.forEach(n=>{const r=displayedRects.value.findIndex(c=>c.id===n.id);r===-1?displayedRects.value.push(n):displayedRects.value[r]=n,removalTimers.has(n.id)&&(clearTimeout(removalTimers.get(n.id)),removalTimers.delete(n.id))}),displayedRects.value.slice().forEach(n=>{if(!i.has(n.id)&&!removalTimers.has(n.id)){const r=window.setTimeout(()=>{const c=displayedRects.value.findIndex(d=>d.id===n.id);c!==-1&&displayedRects.value.splice(c,1),removalTimers.delete(n.id)},100);removalTimers.set(n.id,r)}})}}),onUnmounted(()=>{document.removeEventListener("fullscreenchange",handleFullscreenChange),timer.value&&(clearInterval(timer.value),timer.value=void 0)});const timer=ref(void 0),power=ref(0),current=ref(0),voltage=ref(0),maxPower=ref(0);onMounted(()=>{timer.value=setInterval(()=>{getPower()},1e3)}),watch(showVirtualKeyboard,async s=>{s&&await getOcrMeasurements()});const $q=useQuasar();return $q.dark.set(!0),(s,e)=>(openBlock(),createBlock(QPage,{padding:""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QSpace),createVNode(QBtn,{icon:isFullscreen.value?"fullscreen_exit":"fullscreen",label:isFullscreen.value?"退出全屏":"全屏",onClick:toggleFullscreen,color:"primary",outline:"",size:"sm"},null,8,["icon","label"])]),createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(QCard,{flat:"",bordered:"",class:"q-pa-md"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_4,[e[11]||(e[11]=createBaseVNode("div",{class:"text-subtitle2"},"物理测量",-1)),createBaseVNode("div",_hoisted_5," | 当前电压 "+toDisplayString(voltage.value.toFixed(3))+" V",1),createBaseVNode("div",_hoisted_6," | 当前电流 "+toDisplayString(current.value.toFixed(3))+" A",1),createBaseVNode("div",_hoisted_7," | 当前功率 "+toDisplayString(power.value.toFixed(3))+" W |",1),createBaseVNode("div",_hoisted_8," 最大功率 "+toDisplayString(maxPower.value.toFixed(3))+" W",1)]),createBaseVNode("div",_hoisted_9,[createVNode(QBtn,{color:"primary",label:"获取测量数据",onClick:e[0]||(e[0]=()=>getMeasurements()),loading:measurementsLoading.value},null,8,["loading"]),createVNode(QBtn,{color:"secondary",label:"最小边缘",onClick:e[1]||(e[1]=()=>getMinimumSquareMeasurements()),loading:minSquareLoading.value},null,8,["loading"])]),createVNode(QSeparator,{class:"q-my-md"}),e[17]||(e[17]=createBaseVNode("div",{class:"text-subtitle2"},"OCR 测量",-1)),createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[createVNode(QBtn,{color:showVirtualKeyboard.value?"negative":"primary",icon:showVirtualKeyboard.value?"keyboard_hide":"keyboard",label:showVirtualKeyboard.value?"隐藏键盘":"显示键盘",onClick:e[2]||(e[2]=t=>showVirtualKeyboard.value=!showVirtualKeyboard.value),outline:!showVirtualKeyboard.value},null,8,["color","icon","label","outline"]),createVNode(QSelect,{modelValue:ocrMethod.value,"onUpdate:modelValue":e[3]||(e[3]=t=>ocrMethod.value=t),options:[{label:"OCR测量",value:0},{label:"OCR遮罩测量",value:1},{label:"OCR缩放遮罩测量",value:2},{label:"OCR缩放测量",value:3},{label:"YOLO自动分割测量",value:4},{label:"OCR自动分割测量",value:5}],"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",style:{"min-width":"150px"},label:"识别方法"},null,8,["modelValue"]),withDirectives(createVNode(QSpinnerGears,{color:"primary",size:"2em"},null,512),[[vShow,ocrLoading.value&&fucked.value]])])]),createVNode(QSeparator,{class:"q-my-md"}),e[18]||(e[18]=createBaseVNode("div",{class:"text-subtitle2 q-mt-lg"},"统计信息",-1)),createBaseVNode("div",_hoisted_12,[createBaseVNode("div",null,[e[12]||(e[12]=createTextVNode(" 矩形数量: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.count),1)]),createBaseVNode("div",null,[e[13]||(e[13]=createTextVNode(" 总像素: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.total_pixels),1)]),createBaseVNode("div",null,[e[14]||(e[14]=createTextVNode(" 帧比率: ",-1)),createBaseVNode("strong",null,toDisplayString((stats.frame_ratio*100).toFixed(2))+"%",1)]),createBaseVNode("div",null,[e[15]||(e[15]=createTextVNode(" 黑色比率: ",-1)),createBaseVNode("strong",null,toDisplayString((stats.black_ratio*100).toFixed(2))+"%",1)]),createBaseVNode("div",null,[e[16]||(e[16]=createTextVNode(" 帧率: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.fps.toFixed(1)),1)])]),createVNode(QSeparator,{class:"q-my-md"}),e[19]||(e[19]=createBaseVNode("div",{class:"text-subtitle2"},"检测到的矩形",-1)),(openBlock(!0),createElementBlock(Fragment,null,renderList(displayedRects.value,t=>(openBlock(),createElementBlock("div",{key:t.id},[createBaseVNode("div",null,[createBaseVNode("strong",null,"#"+toDisplayString(t.id),1)]),createBaseVNode("div",null,"外框: "+toDisplayString(t.outer_width)+"×"+toDisplayString(t.outer_height),1),createBaseVNode("div",null,"面积: "+toDisplayString(t.area)+"px",1),createBaseVNode("div",null,"新边: "+toDisplayString(t.new_long_px.toFixed(1))+"px",1),createBaseVNode("div",null,"距离: "+toDisplayString(computeDistance(t.new_long_px).toFixed(1))+" cm",1),createBaseVNode("div",null,"形状: "+toDisplayString(t.shape_type),1),createBaseVNode("div",null,"内框: "+toDisplayString(t.inner_width)+"×"+toDisplayString(t.inner_height)+" (面积 "+toDisplayString(t.inner_area)+"px)",1),createBaseVNode("div",null,"信息: "+toDisplayString(t.inner_info),1)]))),128))]),_:1,__:[17,18,19]})]),createBaseVNode("div",_hoisted_13,[createVNode(QCard,{flat:"",bordered:"",class:"q-pa-md"},{default:withCtx(()=>[createBaseVNode("div",null,[createBaseVNode("p",null,"距离公式："+toDisplayString(formula.value),1),createBaseVNode("p",null,"校正系数："+toDisplayString(correctionFactor.value),1),createVNode(QBtn,{label:"重新加载配置",onClick:loadConfigs})]),measurements.value.length>0?(openBlock(),createElementBlock("div",_hoisted_14,[createBaseVNode("div",_hoisted_15,[e[20]||(e[20]=createBaseVNode("div",{class:"text-subtitle2"},"测量结果",-1)),createVNode(QSpace),createVNode(QBtn,{icon:showDetailedInfo.value?"visibility_off":"visibility",label:showDetailedInfo.value?"隐藏详情":"显示详情",size:"sm",flat:"",color:"primary",onClick:e[4]||(e[4]=t=>showDetailedInfo.value=!showDetailedInfo.value)},null,8,["icon","label"])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(measurements.value,t=>(openBlock(),createElementBlock("div",{key:t.crop_index,class:"q-mb-md"},[createBaseVNode("div",_hoisted_16,"裁剪区域 "+toDisplayString(t.crop_index),1),t.target?(openBlock(),createBlock(QCard,{key:0,class:"q-mb-sm q-pa-sm",style:{"border-radius":"4px"}},{default:withCtx(()=>[createBaseVNode("div",null,[createBaseVNode("strong",null,"目标 #"+toDisplayString(t.target.id),1)]),createBaseVNode("div",null,"像素尺寸: "+toDisplayString(t.target.crop_width)+"×"+toDisplayString(t.target.crop_height),1),createBaseVNode("div",null,"面积: "+toDisplayString(t.target.area)+"px",1),createBaseVNode("div",null,"长边: "+toDisplayString(t.target.new_long_px.toFixed(1))+"px",1),createBaseVNode("div",null,"距离: "+toDisplayString(computeDistance(t.target.new_long_px).toFixed(1))+" cm",1)]),_:2},1024)):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(t.shapes,o=>(openBlock(),createBlock(QCard,{key:o.shape_index,class:"q-mb-sm q-pa-sm",style:{"border-radius":"4px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_17,toDisplayString(o.shape_type)+" #"+toDisplayString(o.shape_index),1),createBaseVNode("div",_hoisted_18,[e[21]||(e[21]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"像素尺寸:",-1)),o.physical_dimensions.measurement_type==="minimum_edge"?(openBlock(),createElementBlock("div",_hoisted_19," 长度: "+toDisplayString(o.pixel_dimensions.width.toFixed(1))+"px ",1)):o.shape_type.toLowerCase().includes("circle")||o.shape_type.toLowerCase().includes("圆")||o.shape_type.toLowerCase().includes("round")?(openBlock(),createElementBlock("div",_hoisted_20,[createTextVNode(" 直径: "+toDisplayString(Math.max(o.pixel_dimensions.width,o.pixel_dimensions.height).toFixed(1))+"px ",1),createBaseVNode("div",null,"面积: "+toDisplayString(o.pixel_dimensions.area)+"px",1),createBaseVNode("div",null,"周长: "+toDisplayString(o.pixel_dimensions.perimeter.toFixed(1))+"px",1)])):(openBlock(),createElementBlock(Fragment,{key:2},[createBaseVNode("div",null," 尺寸: "+toDisplayString(o.pixel_dimensions.width)+"×"+toDisplayString(o.pixel_dimensions.height)+"px ",1),createBaseVNode("div",null,"面积: "+toDisplayString(o.pixel_dimensions.area)+"px",1),o.pixel_dimensions.mean_side_length>0?(openBlock(),createElementBlock("div",_hoisted_21," 平均边长: "+toDisplayString(o.pixel_dimensions.mean_side_length.toFixed(1))+"px ",1)):createCommentVNode("",!0),createBaseVNode("div",null,"周长: "+toDisplayString(o.pixel_dimensions.perimeter.toFixed(1))+"px",1)],64))]),createBaseVNode("div",_hoisted_22,[e[22]||(e[22]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"物理尺寸:",-1)),o.physical_dimensions.measurement_type==="minimum_edge"?(openBlock(),createElementBlock("div",_hoisted_23," 长度: "+toDisplayString((o.physical_dimensions.width_mm*correctionFactor.value).toFixed(1))+"mm ",1)):o.shape_type.toLowerCase().includes("circle")||o.shape_type.toLowerCase().includes("圆")?(openBlock(),createElementBlock("div",_hoisted_24,[createTextVNode(" 直径: "+toDisplayString((o.physical_dimensions.diameter_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",null," 面积: "+toDisplayString((o.physical_dimensions.area_mm2*correctionFactor.value*correctionFactor.value).toFixed(1))+"mm² ",1)])):(openBlock(),createElementBlock(Fragment,{key:2},[createBaseVNode("div",null," 尺寸: "+toDisplayString((o.physical_dimensions.width_mm*correctionFactor.value).toFixed(1))+"×"+toDisplayString((o.physical_dimensions.height_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",null," 面积: "+toDisplayString((o.physical_dimensions.area_mm2*correctionFactor.value*correctionFactor.value).toFixed(1))+"mm² ",1)],64)),showDetailedInfo.value?(openBlock(),createElementBlock(Fragment,{key:3},[o.physical_dimensions.diameter_mm>0?(openBlock(),createElementBlock("div",_hoisted_25," 直径: "+toDisplayString((o.physical_dimensions.diameter_mm*correctionFactor.value).toFixed(1))+"mm ",1)):createCommentVNode("",!0),o.physical_dimensions.mean_side_length_mm>0?(openBlock(),createElementBlock("div",_hoisted_26," 平均边长: "+toDisplayString((o.physical_dimensions.mean_side_length_mm*correctionFactor.value).toFixed(1))+"mm ",1)):createCommentVNode("",!0),createBaseVNode("div",null," 周长: "+toDisplayString((o.physical_dimensions.perimeter_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",_hoisted_27," 方法: "+toDisplayString(o.physical_dimensions.measurement_type)+" ("+toDisplayString(o.physical_dimensions.mm_per_pixel.toFixed(3))+" mm/px, 修正: "+toDisplayString(correctionFactor.value.toFixed(4))+") ",1)],64)):createCommentVNode("",!0)]),showDetailedInfo.value&&o.physical_dimensions.side_lengths_mm.length>0?(openBlock(),createElementBlock("div",_hoisted_28,[e[23]||(e[23]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"边长:",-1)),(openBlock(!0),createElementBlock(Fragment,null,renderList(o.physical_dimensions.side_lengths_mm,(a,l)=>(openBlock(),createElementBlock("div",{key:l}," 边 "+toDisplayString(l+1)+": "+toDisplayString((a*correctionFactor.value).toFixed(1))+"mm ",1))),128))])):createCommentVNode("",!0),o.ocr_data?(openBlock(),createElementBlock("div",_hoisted_29,[e[26]||(e[26]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"OCR 信息:",-1)),o.ocr_data.detected?(openBlock(),createElementBlock("div",_hoisted_30,[createBaseVNode("div",null,[e[24]||(e[24]=createTextVNode(" 文本: ",-1)),createBaseVNode("strong",null,'"'+toDisplayString(o.ocr_data.text)+'"',1)]),createBaseVNode("div",null,"置信度: "+toDisplayString((o.ocr_data.confidence*100).toFixed(1))+"%",1),e[25]||(e[25]=createBaseVNode("div",{class:"text-caption"},"在此形状中检测到 OCR",-1))])):(openBlock(),createElementBlock("div",_hoisted_31,"未检测到 OCR 文本"))])):createCommentVNode("",!0)]),_:2},1024))),128))]))),128)),showDetailedInfo.value&&a4Reference.value?(openBlock(),createElementBlock("div",_hoisted_32,[e[27]||(e[27]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"A4 参考:",-1)),createBaseVNode("div",null,toDisplayString((a4Reference.value.physical_width_mm*correctionFactor.value).toFixed(1))+"×"+toDisplayString((a4Reference.value.physical_height_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",_hoisted_33,toDisplayString(a4Reference.value.note)+" (修正系数: "+toDisplayString(correctionFactor.value.toFixed(4))+") ",1)])):createCommentVNode("",!0),createCommentVNode("",!0)])):createCommentVNode("",!0)]),_:1})])]),createVNode(QDialog,{modelValue:showVirtualKeyboard.value,"onUpdate:modelValue":e[10]||(e[10]=t=>showVirtualKeyboard.value=t),position:"standard",maximized:"","full-width":"","full-height":""},{default:withCtx(()=>[createVNode(QCard,{class:"virtual-keyboard"},{default:withCtx(()=>[createVNode(QCardSection,{class:"row items-center q-pa-sm bg-primary text-white"},{default:withCtx(()=>[e[29]||(e[29]=createBaseVNode("div",{class:"text-h6"},"虚拟键盘",-1)),createVNode(QSpace),createVNode(QBtn,{icon:"close",flat:"",round:"",dense:"",onClick:closeKeyboard})]),_:1,__:[29]}),createVNode(QCardSection,{class:"q-pa-md"},{default:withCtx(()=>[createVNode(QInput,{modelValue:ocrTargetText.value,"onUpdate:modelValue":e[5]||(e[5]=t=>ocrTargetText.value=t),label:"目标文本",dense:"",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_35,[createBaseVNode("div",_hoisted_36,[(openBlock(),createElementBlock(Fragment,null,renderList(["Q","W","E","R","T","Y","U","I","O","P"],t=>createVNode(QBtn,{key:t,label:t,class:"keyboard-key",onClick:o=>onKeyPress(t)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_37,[(openBlock(),createElementBlock(Fragment,null,renderList(["A","S","D","F","G","H","J","K","L"],t=>createVNode(QBtn,{key:t,label:t,class:"keyboard-key",onClick:o=>onKeyPress(t)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_38,[(openBlock(),createElementBlock(Fragment,null,renderList(["Z","X","C","V","B","N","M"],t=>createVNode(QBtn,{key:t,label:t,class:"keyboard-key",onClick:o=>onKeyPress(t)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_39,[(openBlock(),createElementBlock(Fragment,null,renderList(["1","2","3","4","5","6","7","8","9","0"],t=>createVNode(QBtn,{key:t,label:t,class:"keyboard-key",onClick:o=>onKeyPress(t)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_40,[createVNode(QBtn,{label:"空格",class:"keyboard-key keyboard-key-wide",onClick:e[6]||(e[6]=t=>onKeyPress("Space"))}),createVNode(QBtn,{label:"⌫",class:"keyboard-key",onClick:e[7]||(e[7]=t=>onKeyPress("Backspace"))}),createVNode(QBtn,{label:"清空",class:"keyboard-key",onClick:e[8]||(e[8]=t=>onKeyPress("Clear"))}),createVNode(QBtn,{label:"搜索",class:"keyboard-key keyboard-key-primary",color:"primary",onClick:e[9]||(e[9]=t=>onKeyPress("Enter"))})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),IndexPage=_export_sfc(_sfc_main,[["__scopeId","data-v-13a2148e"]]);export{IndexPage as default};
