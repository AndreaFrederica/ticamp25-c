import{c as createComponent,h,s as defineComponent,r as ref,m as reactive,o as onMounted,q as onUnmounted,w as watch,t as createBlock,u as withCtx,x as openBlock,A as createBaseVNode,y as createVNode,B as createCommentVNode,C as createElementBlock,D as toDisplayString,E as withDirectives,F as vShow,G as Fragment,H as renderList,z as createTextVNode}from"./index-D_wNzZOK.js";import{u as useSpinnerProps,c as useSpinner,Q as QBtn}from"./QBtn-BmyzkDqN.js";import{Q as QPage,a as QCard,b as QExpansionItem,c as QCardSection,d as QSeparator,e as QDialog,f as QInput,_ as _export_sfc}from"./_plugin-vue_export-helper-CINA3Xki.js";import"./scroll-BxcJXpsR.js";const QSpace=createComponent({name:"QSpace",setup(){const a=h("div",{class:"q-space"});return()=>a}}),innerHTML='<g transform="translate(-20,-20)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="90 50 50" to="0 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g><g transform="translate(20,20) rotate(15 50 50)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="currentColor"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="90 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g>',QSpinnerGears=createComponent({name:"QSpinnerGears",props:useSpinnerProps,setup(a){const{cSize:e,classes:o}=useSpinner(a);return()=>h("svg",{class:o.value,width:e.value,height:e.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg",innerHTML})}}),_hoisted_1={class:"row items-center q-mb-md"},_hoisted_2={class:"row"},_hoisted_3={key:0,class:"col-6"},_hoisted_4=["src"],_hoisted_5={class:"col-6"},_hoisted_6={class:"flex"},_hoisted_7={class:"text-subtitle2"},_hoisted_8={class:"text-subtitle2"},_hoisted_9={class:"row q-gutter-sm q-mt-sm"},_hoisted_10={class:"q-mt-sm"},_hoisted_11={class:"row q-gutter-sm q-mt-sm"},_hoisted_12={key:0,class:"q-mt-md"},_hoisted_13={class:"row items-center q-mb-sm"},_hoisted_14={class:"text-subtitle2"},_hoisted_15={key:0,class:"q-mb-sm q-pa-sm",style:{background:"#f5f5f5","border-radius":"4px"}},_hoisted_16={class:"text-weight-bold"},_hoisted_17={class:"q-mt-sm"},_hoisted_18={key:0},_hoisted_19={key:1},_hoisted_20={key:0},_hoisted_21={class:"q-mt-sm"},_hoisted_22={key:0},_hoisted_23={key:1},_hoisted_24={key:0},_hoisted_25={key:1},_hoisted_26={class:"text-caption"},_hoisted_27={key:0,class:"q-mt-sm"},_hoisted_28={key:1,class:"q-mt-sm"},_hoisted_29={key:0},_hoisted_30={key:1,class:"text-caption text-grey"},_hoisted_31={key:0,class:"q-mt-md q-pa-sm",style:{background:"#fff3cd","border-radius":"4px"}},_hoisted_32={class:"text-caption"},_hoisted_33={key:1,class:"q-mt-md q-pa-sm",style:{background:"#e8f5e8","border-radius":"4px"}},_hoisted_34={class:"q-mt-sm"},_hoisted_35={class:"keyboard-layout"},_hoisted_36={class:"keyboard-row"},_hoisted_37={class:"keyboard-row"},_hoisted_38={class:"keyboard-row"},_hoisted_39={class:"keyboard-row"},_hoisted_40={class:"keyboard-row"},_sfc_main=defineComponent({__name:"IndexPage",setup(__props){const formula=ref("((524.38/x)**(1/1.003))*100"),correctionFactor=ref(1.0261),stats=reactive({count:0,total_pixels:0,frame_ratio:0,black_ratio:0,fps:0}),displayedRects=ref([]),removalTimers=new Map,cachedMeasurements=ref(void 0),cached=ref(!1),fucked=ref(!1),measurements=ref([]),measurementsLoading=ref(!1),a4Reference=ref(null),minSquareLoading=ref(!1),ocrTargetText=ref(""),ocrLoading=ref(!1),ocrElapsedTime=ref(0),showDetailedInfo=ref(!1),showVirtualKeyboard=ref(!1),isFullscreen=ref(!1);function onKeyPress(a){a==="Backspace"?ocrTargetText.value=ocrTargetText.value.slice(0,-1):a==="Space"?ocrTargetText.value+=" ":a==="Enter"?(showVirtualKeyboard.value=!1,getOrWaitOcrMeasurements()):a==="Clear"?ocrTargetText.value="":ocrTargetText.value+=a}function closeKeyboard(){showVirtualKeyboard.value=!1}function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen().then(()=>{isFullscreen.value=!1}).catch(a=>{console.error("退出全屏时出错:",a)}):document.documentElement.requestFullscreen().then(()=>{isFullscreen.value=!0}).catch(a=>{console.error("进入全屏时出错:",a)})}function handleFullscreenChange(){isFullscreen.value=!!document.fullscreenElement}function computeDistance(px){try{const formulaWithValue=formula.value.replace(/x/g,px.toString());return eval(formulaWithValue)}catch(a){return console.error("计算距离时出错:",a,"公式:",formula.value,"像素:",px),0}}async function getPower(){try{const a=await fetch("/api/ina226/measurements"),e=await a.json();a.status===200?(power.value=e.data.power_w||0,e.data.power_w>maxPower.value&&(maxPower.value=e.data.power_w)):console.error("获取功率数据失败:",e)}catch(a){console.error("获取功率数据时出错:",a)}}async function getMeasurements(){measurementsLoading.value=!0;try{const e=await(await fetch("/api/physical_measurements")).json();e.success?(measurements.value=e.measurements||[],a4Reference.value=e.a4_reference||null):(console.error("获取测量数据失败:",e),measurements.value=[])}catch(a){console.error("获取测量数据时出错:",a),measurements.value=[]}finally{measurementsLoading.value=!1}}async function getMinimumSquareMeasurements(){minSquareLoading.value=!0;try{const e=await(await fetch("/api/minimum_square")).json();if(e.found){const o=[{crop_index:1,target:{id:1,crop_width:Math.abs(e.end_point[0]-e.start_point[0]),crop_height:Math.abs(e.end_point[1]-e.start_point[1]),area:Math.abs(e.end_point[0]-e.start_point[0])*Math.abs(e.end_point[1]-e.start_point[1]),new_long_px:e.edge_length_px},shapes:[{shape_index:1,shape_type:`Minimum Edge (${e.type})`,pixel_dimensions:{width:e.edge_length_px,height:0,area:0,side_lengths:[e.edge_length_px],mean_side_length:e.edge_length_px,perimeter:0},physical_dimensions:{width_mm:e.edge_length_mm,height_mm:0,area_mm2:0,diameter_mm:0,side_lengths_mm:[e.edge_length_mm],mean_side_length_mm:e.edge_length_mm,perimeter_mm:0,measurement_type:"minimum_edge",mm_per_pixel:e.edge_length_mm/e.edge_length_px}}]}];measurements.value=o,a4Reference.value={physical_width_mm:e.edge_length_mm,physical_height_mm:e.edge_length_mm,note:`在中心 (${e.center[0]}, ${e.center[1]}) 检测到最小边缘，长度: ${e.edge_length_mm.toFixed(2)}mm`}}else console.error("未找到最小边缘:",e),measurements.value=[],a4Reference.value=null}catch(a){console.error("获取最小边缘测量数据时出错:",a),measurements.value=[]}finally{minSquareLoading.value=!1}}async function getOrWaitOcrMeasurements(){for(fucked.value=!0;!cached.value||!cachedMeasurements.value;)await new Promise(a=>setTimeout(a,200));console.log(cachedMeasurements.value),measurements.value=cachedMeasurements.value.map(a=>({...a,shapes:a.shapes.filter(e=>ocrTargetText.value.trim()?e.ocr_data.detected&&e.ocr_data.text.toLowerCase().includes(ocrTargetText.value.toLowerCase()):e.ocr_data.detected)})).filter(a=>a.shapes.length>0),cached.value=!1,cachedMeasurements.value=void 0,fucked.value=!1}async function getOcrMeasurements(){ocrLoading.value=!0;try{const e=await(await fetch("/api/ocr_measurement_analysis")).json();if(e.success){ocrElapsedTime.value=e.elapsed_seconds||0;const o=e.analysis.map(t=>({crop_index:t.crop_index,target:t.target,shapes:t.shapes.map(s=>({shape_index:s.shape_index,shape_type:`${s.shape_type} (OCR: "${s.ocr_data.text}")`,pixel_dimensions:{width:s.pixel_dimensions.width,height:s.pixel_dimensions.height,area:s.pixel_dimensions.area,side_lengths:s.pixel_dimensions.side_lengths||[],mean_side_length:s.pixel_dimensions.mean_side_length||0,perimeter:s.pixel_dimensions.perimeter},physical_dimensions:{width_mm:s.physical_dimensions.width_mm,height_mm:s.physical_dimensions.height_mm,area_mm2:s.physical_dimensions.area_mm2,diameter_mm:s.physical_dimensions.diameter_mm||0,side_lengths_mm:s.physical_dimensions.side_lengths_mm||[],mean_side_length_mm:s.physical_dimensions.mean_side_length_mm||0,perimeter_mm:s.physical_dimensions.perimeter_mm,measurement_type:s.physical_dimensions.measurement_type,mm_per_pixel:s.physical_dimensions.mm_per_pixel},ocr_data:s.ocr_data}))})).filter(t=>t.shapes.length>0);cachedMeasurements.value=o,cached.value=!0}else console.error("获取 OCR 测量数据失败:",e),cachedMeasurements.value=void 0}catch(a){console.error("获取 OCR 测量数据时出错:",a),cachedMeasurements.value=void 0}finally{ocrLoading.value=!1}}onMounted(async()=>{document.addEventListener("fullscreenchange",handleFullscreenChange);try{const t=await fetch("/config/custom_string?key=distance_formula");if(t.ok){const s=await t.json();s.success&&s.value?(formula.value=s.value,console.log("已加载距离公式:",formula.value)):console.log("未找到保存的距离公式，使用默认值")}}catch(t){console.error("加载公式配置时出错:",t)}try{const t=await fetch("/config/custom_string?key=correction_factor");if(t.ok){const s=await t.json();if(s.success&&s.value){const l=parseFloat(s.value);!isNaN(l)&&l>0&&(correctionFactor.value=l,console.log("已加载修正系数:",l))}else console.log("未找到保存的修正系数，使用默认值:",correctionFactor.value)}}catch(t){console.error("加载修正系数配置时出错:",t)}const e=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/ws`,o=new WebSocket(e);o.onmessage=t=>{const s=JSON.parse(t.data);stats.count=s.count,stats.total_pixels=s.total_pixels,stats.frame_ratio=s.frame_ratio,stats.black_ratio=s.black_ratio,stats.fps=s.fps;const l=s.rects,c=new Set(l.map(i=>i.id));l.forEach(i=>{const n=displayedRects.value.findIndex(r=>r.id===i.id);n===-1?displayedRects.value.push(i):displayedRects.value[n]=i,removalTimers.has(i.id)&&(clearTimeout(removalTimers.get(i.id)),removalTimers.delete(i.id))}),displayedRects.value.slice().forEach(i=>{if(!c.has(i.id)&&!removalTimers.has(i.id)){const n=window.setTimeout(()=>{const r=displayedRects.value.findIndex(d=>d.id===i.id);r!==-1&&displayedRects.value.splice(r,1),removalTimers.delete(i.id)},100);removalTimers.set(i.id,n)}})}}),onUnmounted(()=>{document.removeEventListener("fullscreenchange",handleFullscreenChange),timer.value&&(clearInterval(timer.value),timer.value=void 0)});const timer=ref(void 0),power=ref(0),maxPower=ref(0);return onMounted(()=>{timer.value=setInterval(()=>{getPower()},1e3)}),watch(showVirtualKeyboard,async a=>{a&&await getOcrMeasurements()}),(a,e)=>(openBlock(),createBlock(QPage,{padding:""},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(QSpace),createVNode(QBtn,{icon:isFullscreen.value?"fullscreen_exit":"fullscreen",label:isFullscreen.value?"退出全屏":"全屏",onClick:toggleFullscreen,color:"primary",outline:"",size:"sm"},null,8,["icon","label"])]),createBaseVNode("div",_hoisted_2,[createCommentVNode("",!0),createBaseVNode("div",_hoisted_5,[createVNode(QCard,{flat:"",bordered:"",class:"q-pa-md"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6,[e[10]||(e[10]=createBaseVNode("div",{class:"text-subtitle2"},"物理测量",-1)),createBaseVNode("div",_hoisted_7,"| 当前功率 "+toDisplayString(power.value.toFixed(3))+" W |",1),createBaseVNode("div",_hoisted_8,"最大功率 "+toDisplayString(maxPower.value.toFixed(3))+" W",1)]),createBaseVNode("div",_hoisted_9,[createVNode(QBtn,{color:"primary",label:"获取测量数据",onClick:getMeasurements,loading:measurementsLoading.value},null,8,["loading"]),createVNode(QBtn,{color:"secondary",label:"最小边缘",onClick:getMinimumSquareMeasurements,loading:minSquareLoading.value},null,8,["loading"])]),createVNode(QSeparator,{class:"q-my-md"}),e[25]||(e[25]=createBaseVNode("div",{class:"text-subtitle2"},"OCR 测量",-1)),createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[createVNode(QBtn,{color:showVirtualKeyboard.value?"negative":"primary",icon:showVirtualKeyboard.value?"keyboard_hide":"keyboard",label:showVirtualKeyboard.value?"隐藏键盘":"显示键盘",onClick:e[0]||(e[0]=o=>showVirtualKeyboard.value=!showVirtualKeyboard.value),outline:!showVirtualKeyboard.value},null,8,["color","icon","label","outline"]),withDirectives(createVNode(QSpinnerGears,{color:"primary",size:"2em"},null,512),[[vShow,ocrLoading.value&&fucked.value]])])]),measurements.value.length>0?(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[e[11]||(e[11]=createBaseVNode("div",{class:"text-subtitle2"},"测量结果",-1)),createVNode(QSpace),createVNode(QBtn,{icon:showDetailedInfo.value?"visibility_off":"visibility",label:showDetailedInfo.value?"隐藏详情":"显示详情",size:"sm",flat:"",color:"primary",onClick:e[1]||(e[1]=o=>showDetailedInfo.value=!showDetailedInfo.value)},null,8,["icon","label"])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(measurements.value,o=>(openBlock(),createElementBlock("div",{key:o.crop_index,class:"q-mb-md"},[createBaseVNode("div",_hoisted_14,"裁剪区域 "+toDisplayString(o.crop_index),1),o.target?(openBlock(),createElementBlock("div",_hoisted_15,[createBaseVNode("div",null,[createBaseVNode("strong",null,"目标 #"+toDisplayString(o.target.id),1)]),createBaseVNode("div",null,"像素尺寸: "+toDisplayString(o.target.crop_width)+"×"+toDisplayString(o.target.crop_height),1),createBaseVNode("div",null,"面积: "+toDisplayString(o.target.area)+"px",1),createBaseVNode("div",null,"长边: "+toDisplayString(o.target.new_long_px.toFixed(1))+"px",1),createBaseVNode("div",null,"距离: "+toDisplayString(computeDistance(o.target.new_long_px).toFixed(1))+" cm",1)])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(o.shapes,t=>(openBlock(),createElementBlock("div",{key:t.shape_index,class:"q-mb-sm q-pa-sm",style:{background:"#e8f4fd","border-radius":"4px"}},[createBaseVNode("div",_hoisted_16,toDisplayString(t.shape_type)+" #"+toDisplayString(t.shape_index),1),createBaseVNode("div",_hoisted_17,[e[12]||(e[12]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"像素尺寸:",-1)),t.physical_dimensions.measurement_type==="minimum_edge"?(openBlock(),createElementBlock("div",_hoisted_18," 长度: "+toDisplayString(t.pixel_dimensions.width.toFixed(1))+"px ",1)):t.shape_type.toLowerCase().includes("circle")||t.shape_type.toLowerCase().includes("圆")||t.shape_type.toLowerCase().includes("round")?(openBlock(),createElementBlock("div",_hoisted_19,[createTextVNode(" 直径: "+toDisplayString(Math.max(t.pixel_dimensions.width,t.pixel_dimensions.height).toFixed(1))+"px ",1),createBaseVNode("div",null,"面积: "+toDisplayString(t.pixel_dimensions.area)+"px",1),createBaseVNode("div",null,"周长: "+toDisplayString(t.pixel_dimensions.perimeter.toFixed(1))+"px",1)])):(openBlock(),createElementBlock(Fragment,{key:2},[createBaseVNode("div",null," 尺寸: "+toDisplayString(t.pixel_dimensions.width)+"×"+toDisplayString(t.pixel_dimensions.height)+"px ",1),createBaseVNode("div",null,"面积: "+toDisplayString(t.pixel_dimensions.area)+"px",1),t.pixel_dimensions.mean_side_length>0?(openBlock(),createElementBlock("div",_hoisted_20," 平均边长: "+toDisplayString(t.pixel_dimensions.mean_side_length.toFixed(1))+"px ",1)):createCommentVNode("",!0),createBaseVNode("div",null,"周长: "+toDisplayString(t.pixel_dimensions.perimeter.toFixed(1))+"px",1)],64))]),createBaseVNode("div",_hoisted_21,[e[13]||(e[13]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"物理尺寸:",-1)),t.physical_dimensions.measurement_type==="minimum_edge"?(openBlock(),createElementBlock("div",_hoisted_22," 长度: "+toDisplayString((t.physical_dimensions.width_mm*correctionFactor.value).toFixed(1))+"mm ",1)):t.shape_type.toLowerCase().includes("circle")||t.shape_type.toLowerCase().includes("圆")?(openBlock(),createElementBlock("div",_hoisted_23,[createTextVNode(" 直径: "+toDisplayString((t.physical_dimensions.diameter_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",null," 面积: "+toDisplayString((t.physical_dimensions.area_mm2*correctionFactor.value*correctionFactor.value).toFixed(1))+"mm² ",1)])):(openBlock(),createElementBlock(Fragment,{key:2},[createBaseVNode("div",null," 尺寸: "+toDisplayString((t.physical_dimensions.width_mm*correctionFactor.value).toFixed(1))+"×"+toDisplayString((t.physical_dimensions.height_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",null," 面积: "+toDisplayString((t.physical_dimensions.area_mm2*correctionFactor.value*correctionFactor.value).toFixed(1))+"mm² ",1)],64)),showDetailedInfo.value?(openBlock(),createElementBlock(Fragment,{key:3},[t.physical_dimensions.diameter_mm>0?(openBlock(),createElementBlock("div",_hoisted_24," 直径: "+toDisplayString((t.physical_dimensions.diameter_mm*correctionFactor.value).toFixed(1))+"mm ",1)):createCommentVNode("",!0),t.physical_dimensions.mean_side_length_mm>0?(openBlock(),createElementBlock("div",_hoisted_25," 平均边长: "+toDisplayString((t.physical_dimensions.mean_side_length_mm*correctionFactor.value).toFixed(1))+"mm ",1)):createCommentVNode("",!0),createBaseVNode("div",null," 周长: "+toDisplayString((t.physical_dimensions.perimeter_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",_hoisted_26," 方法: "+toDisplayString(t.physical_dimensions.measurement_type)+" ("+toDisplayString(t.physical_dimensions.mm_per_pixel.toFixed(3))+" mm/px, 修正: "+toDisplayString(correctionFactor.value.toFixed(4))+") ",1)],64)):createCommentVNode("",!0)]),showDetailedInfo.value&&t.physical_dimensions.side_lengths_mm.length>0?(openBlock(),createElementBlock("div",_hoisted_27,[e[14]||(e[14]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"边长:",-1)),(openBlock(!0),createElementBlock(Fragment,null,renderList(t.physical_dimensions.side_lengths_mm,(s,l)=>(openBlock(),createElementBlock("div",{key:l}," 边 "+toDisplayString(l+1)+": "+toDisplayString((s*correctionFactor.value).toFixed(1))+"mm ",1))),128))])):createCommentVNode("",!0),t.ocr_data?(openBlock(),createElementBlock("div",_hoisted_28,[e[17]||(e[17]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"OCR 信息:",-1)),t.ocr_data.detected?(openBlock(),createElementBlock("div",_hoisted_29,[createBaseVNode("div",null,[e[15]||(e[15]=createTextVNode(" 文本: ",-1)),createBaseVNode("strong",null,'"'+toDisplayString(t.ocr_data.text)+'"',1)]),createBaseVNode("div",null,"置信度: "+toDisplayString((t.ocr_data.confidence*100).toFixed(1))+"%",1),e[16]||(e[16]=createBaseVNode("div",{class:"text-caption"},"在此形状中检测到 OCR",-1))])):(openBlock(),createElementBlock("div",_hoisted_30,"未检测到 OCR 文本"))])):createCommentVNode("",!0)]))),128))]))),128)),showDetailedInfo.value&&a4Reference.value?(openBlock(),createElementBlock("div",_hoisted_31,[e[18]||(e[18]=createBaseVNode("div",{class:"text-caption text-weight-bold"},"A4 参考:",-1)),createBaseVNode("div",null,toDisplayString((a4Reference.value.physical_width_mm*correctionFactor.value).toFixed(1))+"×"+toDisplayString((a4Reference.value.physical_height_mm*correctionFactor.value).toFixed(1))+"mm ",1),createBaseVNode("div",_hoisted_32,toDisplayString(a4Reference.value.note)+" (修正系数: "+toDisplayString(correctionFactor.value.toFixed(4))+") ",1)])):createCommentVNode("",!0),createCommentVNode("",!0)])):createCommentVNode("",!0),createVNode(QSeparator,{class:"q-my-md"}),e[26]||(e[26]=createBaseVNode("div",{class:"text-subtitle2 q-mt-lg"},"统计信息",-1)),createBaseVNode("div",_hoisted_34,[createBaseVNode("div",null,[e[20]||(e[20]=createTextVNode(" 矩形数量: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.count),1)]),createBaseVNode("div",null,[e[21]||(e[21]=createTextVNode(" 总像素: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.total_pixels),1)]),createBaseVNode("div",null,[e[22]||(e[22]=createTextVNode(" 帧比率: ",-1)),createBaseVNode("strong",null,toDisplayString((stats.frame_ratio*100).toFixed(2))+"%",1)]),createBaseVNode("div",null,[e[23]||(e[23]=createTextVNode(" 黑色比率: ",-1)),createBaseVNode("strong",null,toDisplayString((stats.black_ratio*100).toFixed(2))+"%",1)]),createBaseVNode("div",null,[e[24]||(e[24]=createTextVNode(" 帧率: ",-1)),createBaseVNode("strong",null,toDisplayString(stats.fps.toFixed(1)),1)])]),createVNode(QSeparator,{class:"q-my-md"}),e[27]||(e[27]=createBaseVNode("div",{class:"text-subtitle2"},"检测到的矩形",-1)),(openBlock(!0),createElementBlock(Fragment,null,renderList(displayedRects.value,o=>(openBlock(),createElementBlock("div",{key:o.id},[createBaseVNode("div",null,[createBaseVNode("strong",null,"#"+toDisplayString(o.id),1)]),createBaseVNode("div",null,"外框: "+toDisplayString(o.outer_width)+"×"+toDisplayString(o.outer_height),1),createBaseVNode("div",null,"面积: "+toDisplayString(o.area)+"px",1),createBaseVNode("div",null,"新边: "+toDisplayString(o.new_long_px.toFixed(1))+"px",1),createBaseVNode("div",null,"距离: "+toDisplayString(computeDistance(o.new_long_px).toFixed(1))+" cm",1),createBaseVNode("div",null,"形状: "+toDisplayString(o.shape_type),1),createBaseVNode("div",null,"内框: "+toDisplayString(o.inner_width)+"×"+toDisplayString(o.inner_height)+" (面积 "+toDisplayString(o.inner_area)+"px)",1),createBaseVNode("div",null,"信息: "+toDisplayString(o.inner_info),1)]))),128))]),_:1,__:[25,26,27]})])]),createVNode(QDialog,{modelValue:showVirtualKeyboard.value,"onUpdate:modelValue":e[7]||(e[7]=o=>showVirtualKeyboard.value=o),position:"standard",maximized:"","full-width":"","full-height":""},{default:withCtx(()=>[createVNode(QCard,{class:"virtual-keyboard"},{default:withCtx(()=>[createVNode(QCardSection,{class:"row items-center q-pa-sm bg-primary text-white"},{default:withCtx(()=>[e[28]||(e[28]=createBaseVNode("div",{class:"text-h6"},"虚拟键盘",-1)),createVNode(QSpace),createVNode(QBtn,{icon:"close",flat:"",round:"",dense:"",onClick:closeKeyboard})]),_:1,__:[28]}),createVNode(QCardSection,{class:"q-pa-md"},{default:withCtx(()=>[createVNode(QInput,{modelValue:ocrTargetText.value,"onUpdate:modelValue":e[2]||(e[2]=o=>ocrTargetText.value=o),label:"目标文本",dense:"",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_35,[createBaseVNode("div",_hoisted_36,[(openBlock(),createElementBlock(Fragment,null,renderList(["Q","W","E","R","T","Y","U","I","O","P"],o=>createVNode(QBtn,{key:o,label:o,class:"keyboard-key",onClick:t=>onKeyPress(o)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_37,[(openBlock(),createElementBlock(Fragment,null,renderList(["A","S","D","F","G","H","J","K","L"],o=>createVNode(QBtn,{key:o,label:o,class:"keyboard-key",onClick:t=>onKeyPress(o)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_38,[(openBlock(),createElementBlock(Fragment,null,renderList(["Z","X","C","V","B","N","M"],o=>createVNode(QBtn,{key:o,label:o,class:"keyboard-key",onClick:t=>onKeyPress(o)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_39,[(openBlock(),createElementBlock(Fragment,null,renderList(["1","2","3","4","5","6","7","8","9","0"],o=>createVNode(QBtn,{key:o,label:o,class:"keyboard-key",onClick:t=>onKeyPress(o)},null,8,["label","onClick"])),64))]),createBaseVNode("div",_hoisted_40,[createVNode(QBtn,{label:"空格",class:"keyboard-key keyboard-key-wide",onClick:e[3]||(e[3]=o=>onKeyPress("Space"))}),createVNode(QBtn,{label:"⌫",class:"keyboard-key",onClick:e[4]||(e[4]=o=>onKeyPress("Backspace"))}),createVNode(QBtn,{label:"清空",class:"keyboard-key",onClick:e[5]||(e[5]=o=>onKeyPress("Clear"))}),createVNode(QBtn,{label:"搜索",class:"keyboard-key keyboard-key-primary",color:"primary",onClick:e[6]||(e[6]=o=>onKeyPress("Enter"))})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),IndexPage=_export_sfc(_sfc_main,[["__scopeId","data-v-cd567554"]]);export{IndexPage as default};
